<html>
  <head>
    <title>Variazioni morfologiche</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<!--
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.js"></script>    
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="js/leaflet-hash.js"></script>
    <script src="js/label.js"></script>
    <script src="js/Autolinker.min.js"></script>
    <script src="js/leaflet.timeline.min.js"></script>
    <script src="js/leaflet-sidebar.js"></script>
    <script src="js/styledLayerControl.js"></script>
    <script src="js/L.Control.Locate.js"></script>
    <script src="http://leaflet.github.io/Leaflet.draw/leaflet.draw.js"></script>
	<script src="js/leaflet.measurecontrol.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.14/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.8.1/nv.d3.min.js"></script>

    <link href="http://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.css" rel="stylesheet">
    <link rel="stylesheet" href="css/MarkerCluster.css" />
    <link rel="stylesheet" href="css/MarkerCluster.Default.css" />
    <link rel="stylesheet" type="text/css" href="css/own_style.css">
    <link rel="stylesheet" href="css/label.css" />
    <link href="css/leaflet.timeline.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/leaflet-sidebar2.css" />
    <link rel="stylesheet" href="css/styledLayerControl.css" />
    <link rel="stylesheet" href="css/L.Control.Locate.css" />
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="http://leaflet.github.io/Leaflet.draw/leaflet.draw.css"/>
    <link rel="stylesheet" href="css/leaflet.measurecontrol.css" />

    <link rel="stylesheet" href="https://cdn.rawgit.com/novus/nvd3/v1.8.1/build/nv.d3.css" />
       

    <style>
      body{
        margin: 0;
        padding: 0;
      }
      
      html, body, #map {
            height: 100%;
            font: 10pt "Helvetica Neue", Arial, Helvetica, sans-serif;
        }
        
      .lorem {
            font-style: italic;
            color: #AAA;
      }
<!--
      setting che uso per i div in cui metto i graifici
-->
      .set_height 
            {
    width: 500px;
    height: 100px;
    border: 3px solid #73AD21;
      }
      
.custom .leaflet-popup-tip,
.custom .leaflet-popup-content-wrapper {
    background: #2c3e50;
    color: #ffffff;
}

    
<!--
      #map{
        position: fixed;
        top: 0;
        left: 0vw;
        bottom: 0;
        right: 0vw;
        
        width: 100vw;
        height: 100vh;
      }      
-->
      
      .leaflet-bottom.leaflet-right{
        width: 95%;
      }
      .leaflet-control-container .leaflet-timeline-controls{
        box-sizing: border-box;
        width: 90%;
        margin: 0;
        margin-bottom: 0px;
      }



    </style>
  </head>
  <body>
     <div id="sidebar" class="sidebar collapsed">
        <!-- Nav tabs -->
        <ul class="sidebar-tabs" role="tablist">
            <li><a href="#home" role="tab"><i class="fa fa-home fa-lg"></i></a></li>
            <li><a href="#mappa" role="tab"><i class="fa fa-map-o"></i></a></li>
            <li><a href="#misure" role="tab"><i class="fa fa-pie-chart"></i></a></li>
<!--
            <li><a href="#settings" role="tab"><i class="fa fa-gear"></i></a></li>
-->
        </ul>

        <!-- Tab panes -->
        <div class="sidebar-content active">
            <div class="sidebar-pane" id="home">
				
                <h1 align="center">Variazioni morfologiche del Fiume Paglia</h1>
                
                <h2>Informazioni</h2>                
                <p>Il rischio idraulico è oggetto di ampia attenzione da parte di media, tecnici e ricercatori. Meno noto è il rischio connesso alla dinamica dei sedimenti e ai processi di erosione - sedimentazione, cioè il <i>rischio da dinamica d'alveo</i>.
                <BR>Per evidenziare le problematiche connesse con la dinamica fluviale, è stata realizzata questa mappa che mostra le modificazioni subite dal fiume negli ultimi 200 anni.                
                Inoltre, è stata realizzata una seconda <a href="index.html">mappa</a> che riporta i caratteri morfologico-sedimentari e antropici del F. Paglia (tributario del F. Tevere).
                <BR>Il Paglia si presta bene a questo scopo, perché manifesta importanti problemi di erosione e di approfondimento dell'alveo, dovuti soprattutto all'intensa attività estrattiva di inerti, perpetrata nei decenni passati, che ha determinato un forte deficit sedimentario nel sistema fluviale.
                <BR>Le webmaps sono state realizzate con software FOSS:</p>
                
                <p><ul> <li><a href="https://grass.osgeo.org/">GRASS</a> per la georeferenzazione dei documenti storici (mappe del Catasto Gregoriano – 1820; foto aree dei vo-<BR>li GAI – 1954 e AR08 – 1977 Regione Umbria);</li>
                <li>il plugin GRASS di <a href="http://www.qgis.org/">Qgis</a> per la vettorializzazione degli elementi morfologici di interesse;</li>
                <li>Qgis per la gestione e la stilizzazione dei dati;</li>
                <li><a href="http://leafletjs.com/">Leaflet</a> per la realizzazione delle mappe.</li></ul></p>
                
                <h2>Credits</h2>
                <p>La mappa è stata realizzata dal gruppo di Geologia Applicata del Dipartimento di Fisica e Geologia dell'Università di Perugia.</p>
                <p>Le icone del pannello laterale sono tratte da <a href="http://fontawesome.io"> "Font Awesome by Dave Gandy - http://fontawesome.io"</a></p>
                <p>La mappa utilizza i seguenti plugins:</p>
                <p><ul> <li><a href="https://github.com/gregjacobs/Autolinker.js">Autolinker.js</a></li>
                <li><a href="https://github.com/domoritz/leaflet-locatecontrol">leaflet-locatecontrol</a></li>
                <li><a href="https://github.com/makinacorpus/Leaflet.MeasureControl/">Leaflet.MeasureControl</a></li>
                <li><a href="https://github.com/Turbo87/leaflet-sidebar">leaflet-sidebar</a></li>
                <li><a href="https://github.com/davicustodio/Leaflet.StyledLayerControl">Leaflet.StyledLayerControl</a></li></ul></p>
                
                <HR>               
                <p style="text-align:center;">Quest'opera è distribuita con Licenza <a href="http://creativecommons.org/licenses/by-sa/4.0/" rel="license">Creative Commons Attribuzione - Condividi allo stesso modo 4.0 Internazionale</a></p>
                <p style="text-align:center;"><a href="http://creativecommons.org/licenses/by-sa/4.0/" rel="license"><img class=" aligncenter" style="border-width:0;" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" alt="Licenza Creative Commons" /></a></p>                

            </div>
            
            <div class="sidebar-pane" id="mappa">
		    
		       <h2>Istruzioni</h2>
		       <p>Tramite il pannello di controllo dei layers, sulla destra, è possibile scegliere tra 4 mappe di sfondo, basate su <a href="http://www.openstreetmap.org/">Openstreetmap</a>, tra cui una vista aerea riferibile all'anno 2011.
		       Oppure è possibile utilizzare come sfondo le ortofotocarte degli anni 2008, 2000 e 1988 fornite dal <a href="http://www.pcn.minambiente.it/GN/">Geoportale Nazionale</a>.
		       
		    </div>
            
            <div class="sidebar-pane" id="misure"><h2>Misure</h2>
            
                    <div class='set_height' id='chart1'>
                        <svg></svg>
                    </div>

                    <div class='set_height' id='chart2'>
                        <svg></svg>
                    </div>
                    </div>
                </div>
            </div>

    <div id="map" class="sidebar-map" ></div> 
    
    <script src="data/creagrafico.js"></script> 
    <script src="data/exp_Limitebacinoidrografico.js"></script>
    <script>
		function doStyle(feature) {
			switch (feature.properties.descrizio) {
				case 'barra attiva - nuda':
					return {
						weight: '1.3',
						fillColor: '#fdf56f',
						color: '#000000',
						weight: '1',
						dashArray: '',
						opacity: '0.5',
						fillOpacity: '0.5',
					};
					break;
				case 'barra attiva - vegetata':
					return {
						weight: '1.3',
						fillColor: '#49e43e',
						color: '#000000',
						weight: '1',
						dashArray: '',
						opacity: '0.5',
						fillOpacity: '0.5',
					};
					break;
				case 'barra sospesa - arborata':
					return {
						weight: '1.3',
						fillColor: '#24721f',
						color: '#000000',
						weight: '1',
						dashArray: '',
						opacity: '0.5',
						fillOpacity: '0.5',
					};
					break;
                case 'alveo pieno':
					return {
						weight: '1.3',
						fillColor: '#8c8c8c',
						color: '#000000',
						weight: '1',
						dashArray: '',
						opacity: '0.5',
						fillOpacity: '0.5',
					};
					break;
				case 'canale di magra':
					return {
						weight: '1.3',
						fillColor: '#289dea',
						color: '#000000',
						weight: '1',
						dashArray: '',
						opacity: '0.5',
						fillOpacity: '0.5',
					};
					break;
			}
		}
		
      function getColorFor(str) { // java String#hashCode
        var hash = 0;
        for (var i = 0; i < str.length; i++) {
          hash = str.charCodeAt(i) + ((hash << 5) - hash);
        }
        var red = (hash >> 24) & 0xff;
        var grn = (hash >> 16) & 0xff;
        var blu = (hash >>  8) & 0xff;
        return 'rgb(' + red + ',' + grn + ',' + blu + ')';
      } 
      var additional_attrib = 'created by Andrea Fredduzzi and Pierluigi De Rosa<br>';
      var osmUrl = 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
      var osmAttrib = '&copy; <a href="http://openstreetmap.org/copyright">OpenStreetMap</a> contributors';
      var osm = L.tileLayer(osmUrl, {maxZoom: 18, attribution: additional_attrib + osmAttrib});
      
      var basemap_1 = L.tileLayer('http://a.tile.stamen.com/toner/{z}/{x}/{y}.png', { 
			attribution: additional_attrib + 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data: &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors,<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'
		});
		
	  var mapbox_streets = L.tileLayer('https://{s}.tiles.mapbox.com/v4/freddi.m2nc4a39/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiZnJlZGRpIiwiYSI6InhWUFRCYk0ifQ.qmjZlLlDE-EnjmTwp9Rf0Q', {
	      attribution: additional_attrib + 'Map tiles by <a href="https://www.mapbox.com/">MapBox</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data: &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors,<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'});
		
	  var mapbox_satellite = L.tileLayer('https://{s}.tiles.mapbox.com/v4/freddi.m2nj71k6/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiZnJlZGRpIiwiYSI6InhWUFRCYk0ifQ.qmjZlLlDE-EnjmTwp9Rf0Q', {
	      attribution: additional_attrib + 'Map tiles by <a href="https://www.mapbox.com/">MapBox</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data: &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors,<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'});		
		
      var orto_2000 = L.tileLayer.wms("http://wms.pcn.minambiente.it/ogc?map=/ms_ogc/WMS_v1.3/raster/ortofoto_colore_00.map", {
          layers: 'OI.ORTOIMMAGINI.2000.',
          format: 'image/png',
          transparent: false,
          version: '1.1.0',
          attribution: additional_attrib + 'Aerial imagery: &copy; <a href="http://www.pcn.minambiente.it/GN/accesso-ai-servizi/servizi-di-visualizzazione-wms">GEOPORTALE NAZIONALE</a>'
      });
      
      var orto_88 = L.tileLayer.wms("http://wms.pcn.minambiente.it/ogc?map=/ms_ogc/WMS_v1.3/raster/ortofoto_bn_88.map", {
          layers: 'OI.ORTOIMMAGINI.1988.',
          format: 'image/png',
          transparent: false,
          version: '1.1.0',
          attribution:  additional_attrib + 'Aerial imagery: &copy; <a href="http://www.pcn.minambiente.it/GN/accesso-ai-servizi/servizi-di-visualizzazione-wms">GEOPORTALE NAZIONALE</a>'
      });
      
      var orto_2008 = L.tileLayer.wms("http://wms.pcn.minambiente.it/ogc?map=/ms_ogc/WMS_v1.3/raster/ortofoto_colore_08.map", {
          layers: 'OI.ORTOIMMAGINI.2008',
          format: 'image/png',
          transparent: false,
          version: '1.1.0',
          attribution: additional_attrib + 'Aerial imagery: &copy; <a href="http://www.pcn.minambiente.it/GN/accesso-ai-servizi/servizi-di-visualizzazione-wms">GEOPORTALE NAZIONALE</a>'
      });      
      
      
      var map = L.map('map', {layers: [osm], center: new L.LatLng(42.74665,12.10176), zoom: 13 ,zoomControl: true});
      
      var layerOrder=new Array();
      
      function pop_alvei(feature, layer) {					
			var popupContent = '<b>Data: </b>' + Autolinker.link(String(feature.properties['start'])) + '<BR><b>Unità morfolgica: </b>' + Autolinker.link(String(feature.properties['descrizio'])) ;
			layer.bindPopup(popupContent, {'className':'custom'});
		}      
      
        
      function onLoadData(data){
        var timeline = L.timeline(data, {
          style:  doStyle,
          onEachFeature:pop_alvei,
          waitToUpdateMap: false
        });
        var timelineControl = L.timelineSliderControl({
          formatOutput: function(date){
            return new Date(date).toString();
          },
          position:"bottomright",
          enableKeyboardControls: true,
        });
        timeline.addTo(map);
        timelineControl.addTo(map);
        timelineControl.addTimelines(timeline);
      }
      
      function doStyleLimitebacinoidrografico(feature) {
				return {
					weight: 2.3,
					color: '#00007f',
					dashArray: '',
					opacity: 1.0,
					fillOpacity: 1.0
				};
		}
		var exp_LimitebacinoidrograficoJSON = L.geoJson(exp_Limitebacinoidrografico,{
			//onEachFeature: pop_Limitebacinoidrografico,
			style: doStyleLimitebacinoidrografico
		});
		//add comment sign to hide this layer on the map in the initial view.
		//feature_group.addLayer(exp_LimitebacinoidrograficoJSON);      
		exp_LimitebacinoidrograficoJSON.addTo(map);
        

    /*var baseMaps = {

		'OSM Standard': osm,
		'Stamen Toner': basemap_1,
		'Mapbox': mapbox_streets,
		'Mapbox aerial (2011)':mapbox_satellite,
		'Ortofoto 1988 (WMS)':orto_88,
		'Ortofoto 2000 (WMS)':orto_2000,
		'Ortofoto 2008 (WMS)':orto_2008};

    L.control.layers(baseMaps,{},{collapsed:true}).addTo(map);*/
	
	
	var baseMaps = [
                    { 
                        groupName : "Sfondi TMS",
                        expanded : true,
                        layers    : {
                            "OSM standard"			: osm,
                            'Stamen Toner'			: basemap_1,
                            "Mapbox"				:  mapbox_streets,
                            "Mapbox aerial (2011)"	:  mapbox_satellite
                        }
                        },{
                        groupName : "Sfondi WMS",
                        expanded  : true,
                        layers    : { 
                            'Ortofoto 1988 (WMS)':orto_88,
		                    'Ortofoto 2000 (WMS)':orto_2000,
		                    'Ortofoto 2008 (WMS)':orto_2008
                        }
                    }                       
    ];
    var overlays = [
                     {
                        groupName : "Variazioni morfologiche",
                        expanded  : true,
                        layers    : {                             
                            "Limite del bacino idrografico"     : exp_LimitebacinoidrograficoJSON
                                                      
                        }    
	                    }
    ];	    
    
	                 
	
	var options = {
        position			: "topright",
        container_width     : "235px",
        container_maxHeight : "370px", 
        group_maxHeight     : "130px",
        collapsed			: true,
        exclusive           : false
    };
	
	var control = L.Control.styledLayerControl(baseMaps, overlays, options);
    map.addControl(control);	    

     var sidebar = L.control.sidebar('sidebar').addTo(map);
     //L.control.locate().addTo(map);
     L.Control.measureControl({position: 'topleft'}).addTo(map);
     
    </script>

    <script src="data/alvei_TOT.js"></script>
    
    
</script>
  </body>
</html>
